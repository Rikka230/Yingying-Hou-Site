<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Galerie photo — Yingying HOU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Galerie officielle de photos de Yingying HOU. Photos de studio, tournages et portraits HD." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
  <a class="skip" href="#main">Aller au contenu</a>

  <header class="site-header">
    <div class="wrap">
      <a class="brand" href="/">Yingying <strong>HOU</strong></a>
      <button class="nav-toggle" aria-expanded="false" aria-controls="nav">Menu</button>
      <nav id="nav" class="site-nav">
        <ul>
          <li><a href="/">Accueil</a></li>
          <li><a href="/filmographie.html">Filmographie</a></li>
          <li class="active"><a href="/galerie.html" aria-current="page">Galerie</a></li>
          <li><a href="/contact.html">Contact / Booking</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main id="main">
    <section class="page-hero">
      <div class="wrap">
        <h1>Galerie Photo</h1>
        <p class="kicker">Portraits studio, photos de tournage et festivals.</p>
      </div>
    </section>

    <section class="wrap pad">
  <div class="gallery-grid" id="gallery">
    </div>
</section>

    <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
      <button class="lb-close" aria-label="Fermer">✕</button>
      <button class="lb-prev" aria-label="Précédent">‹</button>
      <figure class="lb-figure">
        <img id="lb-image" src="" alt="">
        <figcaption id="lb-caption"></figcaption>
      </figure>
      <button class="lb-next" aria-label="Suivant">›</button>
    </div>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>© <span id="year"></span> Yingying HOU. Powered by NOCX WEB. Tous droits réservés.</p>
      <nav><a href="/legal.html">Mentions légales</a> <a href="/privacy.html">Confidentialité</a></nav>
    </div>
  </footer>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    // Tes clés secrètes Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyD_Yvi_u5WixeTxuuEORgwFtxksAm7OUY4",
      authDomain: "kukyying-f1c95.firebaseapp.com",
      projectId: "kukyying-f1c95",
      storageBucket: "kukyying-f1c95.firebasestorage.app",
      messagingSenderId: "681899915263",
      appId: "1:681899915263:web:4d64dcf4a9c57748ead9ca"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function chargerGalerie() {
      try {
        const querySnapshot = await getDocs(collection(db, "galerie"));
        const conteneurGalerie = document.getElementById('gallery');
        
        let photos = [];
        querySnapshot.forEach((doc) => photos.push(doc.data()));

        if (photos.length > 0) {
          conteneurGalerie.innerHTML = ''; 
          
          // 1. On injecte les photos dans la grille
          photos.forEach((photo, index) => {
            const a = document.createElement('a');
            a.href = photo.url;
            a.className = 'gallery-item';
            a.setAttribute('data-caption', photo.caption || '');
            
            a.innerHTML = `
              <img src="${photo.url}" alt="${photo.caption || 'Photo'}" loading="lazy">
              <div class="item-overlay"><span>Agrandir</span></div>
            `;
            
            conteneurGalerie.appendChild(a);
          });

          // ==========================================
          // 2. RECONNEXION DE LA LIGHTBOX (ZOOM)
          // ==========================================
          
          // On "nettoie" l'ancienne lightbox pour désactiver les vieux réglages de main.js
          const ancienneLightbox = document.getElementById('lightbox');
          const lightbox = ancienneLightbox.cloneNode(true);
          ancienneLightbox.parentNode.replaceChild(lightbox, ancienneLightbox);

          const lbImage = lightbox.querySelector('#lb-image');
          const lbCaption = lightbox.querySelector('#lb-caption');
          const btnClose = lightbox.querySelector('.lb-close');
          const btnPrev = lightbox.querySelector('.lb-prev');
          const btnNext = lightbox.querySelector('.lb-next');

          let indexActuel = 0;

          // Fonction magique pour afficher la bonne photo
          const afficherPhoto = (index) => {
            indexActuel = index;
            lbImage.src = photos[indexActuel].url;
            lbCaption.textContent = photos[indexActuel].caption || '';
            lightbox.setAttribute('aria-hidden', 'false');
          };

          // On branche le clic sur chaque nouvelle photo de la grille
          const nouveauxLiens = conteneurGalerie.querySelectorAll('.gallery-item');
          nouveauxLiens.forEach((lien, index) => {
            lien.addEventListener('click', (e) => {
              e.preventDefault(); // Empêche d'ouvrir l'image dans une nouvelle page brute
              afficherPhoto(index);
            });
          });

          // On rend les boutons de navigation fonctionnels
          btnClose.addEventListener('click', () => lightbox.setAttribute('aria-hidden', 'true'));
          
          btnNext.addEventListener('click', () => {
            afficherPhoto((indexActuel + 1) % photos.length);
          });
          
          btnPrev.addEventListener('click', () => {
            afficherPhoto((indexActuel - 1 + photos.length) % photos.length);
          });

          // Bonus confort : fermer la lightbox en cliquant dans le vide autour de la photo
          lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox || e.target.classList.contains('lb-figure')) {
              lightbox.setAttribute('aria-hidden', 'true');
            }
          });

          console.log("✅ Galerie et Lightbox connectées avec succès !");

        } else {
          console.log("⚠️ Aucune photo trouvée dans Firebase.");
        }

      } catch (erreur) {
        console.error("❌ Erreur de chargement :", erreur);
      }
    }
    
    chargerGalerie();
  </script>
  <script src="/js/main.js" defer></script>
</body>
</html>
