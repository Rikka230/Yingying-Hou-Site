<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Galerie photo — Yingying HOU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Galerie officielle de photos de Yingying HOU. Photos de studio, tournages et portraits HD." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css" />
  <style>
    .gallery-filters { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin: 30px auto 10px; max-width: 900px; }
    .filter-btn { padding: 8px 20px !important; font-size: 0.9rem !important; cursor: pointer; transition: all 0.3s ease; }
    #gallery { transition: opacity 0.3s ease-in-out; min-height: 60vh; }
  </style>
</head>
<body>
  <script>if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');</script>
  
  <a class="skip" href="#main">Aller au contenu</a>

  <header class="site-header" role="banner">
    <div class="wrap" style="display: flex; justify-content: space-between; align-items: center;">
      <a class="brand" href="/">Yingying <strong>HOU</strong></a>
      <nav id="nav" class="site-nav" role="navigation" aria-label="Navigation principale">
        <ul>
          <li><a href="/">Accueil</a></li>
          <li><a href="filmographie.html">Filmographie</a></li>
          <li><a href="galerie.html">Galerie</a></li>
          <li><a href="contact.html">Contact / Booking</a></li>
        </ul>
      </nav>
      <div class="header-right">
        <button id="theme-toggle-btn" class="theme-toggle-modern" aria-label="Changer le thème"></button>
        <button class="nav-toggle" aria-expanded="false" aria-controls="nav">Menu</button>
      </div>
    </div>
  </header>

  <main id="main">
    <section class="page-hero">
      <div class="wrap">
        <h1>Galerie Photo</h1>
        <p class="kicker">Portraits studio, photos de tournage et presse.</p>
        <div class="gallery-filters" id="filters-container">
          <button class="btn filter-btn" data-filter="Tout">Tout</button>
          <button class="btn outline filter-btn" data-filter="Portrait">Portrait</button>
          <button class="btn outline filter-btn" data-filter="Profil">Profil</button>
          <button class="btn outline filter-btn" data-filter="En pied">En pied</button>
          <button class="btn outline filter-btn" data-filter="Pose">Pose</button>
          <button class="btn outline filter-btn" data-filter="Tournage">Tournage</button>
          <button class="btn outline filter-btn" data-filter="Presse">Presse</button>
        </div>
      </div>
    </section>

    <section class="wrap pad" style="padding-top: 20px;">
      <div class="gallery-grid" id="gallery">
        <p style="text-align:center; color:#888;">Chargement de la galerie...</p>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>© <span id="year"></span> Yingying HOU. Powered by NOCX WEB. Tous droits réservés.</p>
      <nav><a href="/legal.html">Mentions légales</a> <a href="/privacy.html">Confidentialité</a></nav>
    </div>
  </footer>

  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
    <button class="lb-close" aria-label="Fermer">✕</button>
    <button class="lb-prev" aria-label="Précédent">‹</button>
    <figure class="lb-figure">
      <img id="lb-image" src="" alt="">
      <figcaption id="lb-caption"></figcaption>
    </figure>
    <button class="lb-next" aria-label="Suivant">›</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD_Yvi_u5WixeTxuuEORgwFtxksAm7OUY4",
      authDomain: "kukyying-f1c95.firebaseapp.com",
      projectId: "kukyying-f1c95",
      storageBucket: "kukyying-f1c95.firebasestorage.app",
      messagingSenderId: "681899915263",
      appId: "1:681899915263:web:4d64dcf4a9c57748ead9ca"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let toutesLesPhotos = []; 
    let photosAffichees = []; 
    let indexActuel = 0;
    let timerFiltre = null;

    const conteneurGalerie = document.getElementById('gallery');
    const lightbox = document.getElementById('lightbox');
    const lbImage = document.getElementById('lb-image');
    const lbCaption = document.getElementById('lb-caption');

    async function chargerGalerie() {
      try {
        const q = query(collection(db, "galerie"), orderBy("ordre", "asc"));
        const snapshot = await getDocs(q);
        if (!snapshot.empty) {
          snapshot.forEach((doc) => { toutesLesPhotos.push(doc.data()); });
          afficherGrille('Tout');
        }
      } catch (erreur) { console.error(erreur); }
    }

    function afficherGrille(categorieFiltre) {
      clearTimeout(timerFiltre);
      conteneurGalerie.style.opacity = '0';
      timerFiltre = setTimeout(() => {
        conteneurGalerie.innerHTML = ""; 
        photosAffichees = (categorieFiltre === 'Tout') ? toutesLesPhotos : toutesLesPhotos.filter(p => p.categorie === categorieFiltre);
        
        photosAffichees.forEach((data, index) => {
          const item = document.createElement('a');
          item.href = "#";
          item.className = "gallery-item";
          item.innerHTML = `<img src="${data.url}" alt="${data.caption || ''}" loading="lazy"><div class="item-overlay"><span>Agrandir</span></div>`;
          item.onclick = (e) => { e.preventDefault(); afficherPhoto(index); };
          conteneurGalerie.appendChild(item);
        });
        conteneurGalerie.style.opacity = '1';
      }, 300);
    }

    const boutonsFiltres = document.querySelectorAll('.filter-btn');
    boutonsFiltres.forEach(btn => {
      btn.addEventListener('click', () => {
        boutonsFiltres.forEach(f => { f.classList.remove('btn'); f.classList.add('btn', 'outline'); });
        btn.classList.remove('outline');
        afficherGrille(btn.getAttribute('data-filter'));
      });
    });

    // --- GESTION DE LA LIGHTBOX (CORRIGÉE) ---
    function afficherPhoto(index) {
      indexActuel = index;
      lbImage.src = photosAffichees[index].url;
      lbCaption.textContent = photosAffichees[index].caption || "";
      lightbox.setAttribute('aria-hidden', 'false');
      // FIX : On fige le scroll du site derrière
      document.body.style.overflow = 'hidden'; 
    }

    lightbox.querySelector('.lb-close').onclick = () => {
      lightbox.setAttribute('aria-hidden', 'true');
      // FIX : On redonne le scroll au site
      document.body.style.overflow = ''; 
    };
    
    lightbox.querySelector('.lb-next').onclick = () => afficherPhoto((indexActuel + 1) % photosAffichees.length);
    lightbox.querySelector('.lb-prev').onclick = () => afficherPhoto((indexActuel - 1 + photosAffichees.length) % photosAffichees.length);

    chargerGalerie();
  </script>
  <script src="/js/main.js" defer></script>
</body>
</html>
