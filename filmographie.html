<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Filmographie — Yingying HOU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Filmographie complète de Yingying HOU : longs métrages, courts, séries TV, théâtre et voix." />
  <link rel="canonical" href="https://www.example.com/filmographie.html" />
  <meta property="og:title" content="Filmographie — Yingying HOU" />
  <meta property="og:description" content="Sélection d'œuvres, rôles, années, réalisateurs et formats." />
  <meta property="og:type" content="profile" />
  <meta property="og:image" content="https://www.example.com/img/og.jpg" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <script>if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');</script>
  <a class="skip" href="#main">Aller au contenu</a>
  
  <header class="site-header" role="banner">
    <div class="wrap" style="display: flex; justify-content: space-between; align-items: center;">
      <a class="brand" href="/">Yingying <strong>HOU</strong></a>
      
      <nav id="nav" class="site-nav" role="navigation" aria-label="Navigation principale">
        <ul>
          <li><a href="/">Accueil</a></li>
          <li><a href="filmographie.html">Filmographie</a></li>
          <li><a href="galerie.html">Galerie</a></li>
          <li><a href="contact.html">Contact / Booking</a></li>
        </ul>
      </nav>

      <div class="header-right">
        <button id="theme-toggle-btn" class="theme-toggle-modern" aria-label="Changer le thème">
          </button>
        <button class="nav-toggle" aria-expanded="false" aria-controls="nav">Menu</button>
      </div>
    </div>
  </header>

  <main id="main">
    <section class="page-hero">
      <div class="wrap">
        <h1>Filmographie</h1>
        <p class="kicker">Longs métrages, courts, séries, voix & théâtre.</p>
      </div>
    </section>

    <section class="wrap pad">
      <div class="filters" style="margin-bottom: 20px; display: flex; gap: 20px; flex-wrap: wrap;">
        <label>Catégorie
          <select id="filter-category" autocomplete="off">
            <option value="all" selected>Toutes</option>
            <option value="Long métrage">Long métrage</option>
            <option value="Court métrage">Court métrage</option>
            <option value="Série TV">Série TV</option>
            <option value="Réalisation">Réalisation</option>
            <option value="Pub">Pub</option>
            <option value="Théâtre">Théâtre</option>
            <option value="Voix">Voix</option>
          </select>
        </label>
        
        <label>Trier par
          <select id="sort-by" autocomplete="off">
            <option value="year-desc" selected>Année ↓</option>
            <option value="year-asc">Année ↑</option>
            <option value="title-asc">Titre A→Z</option>
            <option value="title-desc">Titre Z→A</option>
          </select>
        </label>
      </div>

      <div class="table-wrap">
        <table class="table" id="filmography">
  <thead>
    <tr>
      <th scope="col">Année</th>
      <th scope="col">Titre</th>
      <th scope="col">Rôle</th>
      <th scope="col">Réalisateur</th>
      <th scope="col">Catégorie</th>
      <th scope="col"><span class="sr-only">Détails</span></th>
    </tr>
  </thead>
  <tbody>
    </tbody>
</table>
      </div>

      <dialog id="detailDialog" aria-label="Détail de l'œuvre" style="padding: 20px; border: none; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); max-width: 500px;">
        <button class="dialog-close" aria-label="Fermer" style="float: right; border: none; background: none; font-size: 1.5rem; cursor: pointer;">×</button>
        <div class="dialog-body">
          <img id="detailPoster" alt="Affiche" style="width: 100%; border-radius: 4px; margin-bottom: 15px; display: none;"/>
          <div>
            <h2 id="detailTitle" style="margin-bottom: 10px;"></h2>
            <p id="detailSynopsis" style="margin-bottom: 15px;"></p>
            <p><a id="detailImdb" class="btn" href="#" target="_blank" rel="noopener" style="display: none;">Voir sur IMDb</a></p>
          </div>
        </div>
      </dialog>
    </section>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <p>© <span id="year"></span> Yingying HOU. Powered by NOCX WEB. Tous droits réservés</p>
      <nav>
        <a href="/legal.html">Mentions légales</a>
        <a href="/privacy.html">Confidentialité</a>
      </nav>
    </div>
  </footer>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD_Yvi_u5WixeTxuuEORgwFtxksAm7OUY4",
      authDomain: "kukyying-f1c95.firebaseapp.com",
      projectId: "kukyying-f1c95",
      storageBucket: "kukyying-f1c95.firebasestorage.app",
      messagingSenderId: "681899915263",
      appId: "1:681899915263:web:4d64dcf4a9c57748ead9ca"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function chargerFilmographie() {
      try {
        const querySnapshot = await getDocs(collection(db, "role"));
        let roles = [];
        querySnapshot.forEach((doc) => roles.push(doc.data()));

        const tbody = document.querySelector('#filmography tbody');
        
        // 1. On "débranche" les anciens filtres de main.js pour éviter les conflits
        const ancienFiltre = document.getElementById('filter-category');
        const nouveauFiltre = ancienFiltre.cloneNode(true);
        ancienFiltre.parentNode.replaceChild(nouveauFiltre, ancienFiltre);

        const ancienTri = document.getElementById('sort-by');
        const nouveauTri = ancienTri.cloneNode(true);
        ancienTri.parentNode.replaceChild(nouveauTri, ancienTri);

        // 2. La fonction magique qui affiche et trie en même temps
        function afficherTableau() {
          tbody.innerHTML = ''; // On vide le tableau

          const categorieChoisie = nouveauFiltre.value;
          const triChoisi = nouveauTri.value;

          // Étape A : On filtre par catégorie
          let rolesFiltres = roles;
          if (categorieChoisie !== 'all') {
            rolesFiltres = roles.filter(role => role.type === categorieChoisie);
          }

          // Étape B : On trie selon le choix
          rolesFiltres.sort((a, b) => {
            if (triChoisi === 'year-desc') return (b.annee || 0) - (a.annee || 0);
            if (triChoisi === 'year-asc') return (a.annee || 0) - (b.annee || 0);
            if (triChoisi === 'title-asc') return (a.projet || '').localeCompare(b.projet || '');
            if (triChoisi === 'title-desc') return (b.projet || '').localeCompare(a.projet || '');
            return 0;
          });

          // Étape C : On crée les lignes
          rolesFiltres.forEach(role => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${role.annee || ''}</td>
              <td>${role.projet || ''}</td>
              <td>${role.titre || ''}</td>
              <td>${role.realisateur || '-'}</td>
              <td>${role.type || ''}</td>
              <td><a class="link" href="${role.lien || '#'}" target="_blank">Voir</a></td>
            `;
            tbody.appendChild(tr);
          });
        }

        // 3. On branche nos nouveaux menus déroulants pour qu'ils réagissent au clic !
        nouveauFiltre.addEventListener('change', afficherTableau);
        nouveauTri.addEventListener('change', afficherTableau);

        // 4. On lance l'affichage une première fois au chargement
        if (roles.length > 0) {
          afficherTableau();
          console.log("✅ Filmographie et filtres connectés avec succès !");
        }

      } catch (erreur) {
        console.error("❌ Erreur :", erreur);
      }
    }
    
    chargerFilmographie();
  </script>
  <script src="js/main.js" defer></script>
</body>
</html>
