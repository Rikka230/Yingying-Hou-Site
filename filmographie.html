<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Filmographie — Yingying HOU</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <script>if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');</script>
  
  <header class="site-header" role="banner">
    <div class="wrap" style="display: flex; justify-content: space-between; align-items: center;">
      <a class="brand" href="/">Yingying <strong>HOU</strong></a>
      <nav id="nav" class="site-nav">
        <ul>
          <li><a href="/">Accueil</a></li>
          <li><a href="filmographie.html">Filmographie</a></li>
          <li><a href="galerie.html">Galerie</a></li>
          <li><a href="contact.html">Contact / Booking</a></li>
        </ul>
      </nav>
      <div class="header-right">
        <button id="theme-toggle-btn" class="theme-toggle-modern" aria-label="Changer le thème"></button>
        <button class="nav-toggle" aria-expanded="false" aria-controls="nav">Menu</button>
      </div>
    </div>
  </header>

  <main id="main">
    <section class="page-hero">
      <div class="wrap">
        <h1>Filmographie</h1>
        <p class="kicker">Longs métrages, courts, séries, voix & théâtre.</p>
      </div>
    </section>

    <section class="wrap pad">
      <div class="filters" style="margin-bottom: 20px; display: flex; gap: 20px; flex-wrap: wrap;">
        <label>Catégorie
          <select id="filter-category" autocomplete="off">
            <option value="all" selected>Toutes</option>
            <option value="Long métrage">Long métrage</option>
            <option value="Court métrage">Court métrage</option>
            <option value="Série TV">Série TV</option>
            <option value="Pub">Pub</option>
            <option value="Théâtre">Théâtre</option>
            <option value="Voix">Voix</option>
          </select>
        </label>
        
        <label>Trier par
          <select id="sort-by" autocomplete="off">
            <option value="year-desc" selected>Année ↓</option>
            <option value="year-asc">Année ↑</option>
            <option value="title-asc">Titre A→Z</option>
          </select>
        </label>
      </div>

      <div class="table-wrap">
        <table class="table" id="filmography">
          <thead>
            <tr>
              <th>Année</th>
              <th>Titre</th>
              <th>Rôle</th>
              <th>Réalisateur</th>
              <th>Catégorie</th>
              <th>Lien</th>
            </tr>
          </thead>
          <tbody>
            </tbody>
        </table>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD_Yvi_u5WixeTxuuEORgwFtxksAm7OUY4",
      authDomain: "kukyying-f1c95.firebaseapp.com",
      projectId: "kukyying-f1c95",
      storageBucket: "kukyying-f1c95.firebasestorage.app",
      messagingSenderId: "681899915263",
      appId: "1:681899915263:web:4d64dcf4a9c57748ead9ca"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function chargerFilmographie() {
      try {
        const querySnapshot = await getDocs(collection(db, "role"));
        let roles = [];
        querySnapshot.forEach((doc) => roles.push(doc.data()));

        const tbody = document.querySelector('#filmography tbody');
        const filterCat = document.getElementById('filter-category');
        const sortBtn = document.getElementById('sort-by');

        function afficherTableau() {
          tbody.innerHTML = '';
          let rolesFiltres = [...roles];

          // 1. Filtrage
          if (filterCat.value !== 'all') {
            rolesFiltres = rolesFiltres.filter(r => r.type === filterCat.value);
          }

          // 2. Tri
          rolesFiltres.sort((a, b) => {
            if (sortBtn.value === 'year-desc') return (b.annee || 0) - (a.annee || 0);
            if (sortBtn.value === 'year-asc') return (a.annee || 0) - (b.annee || 0);
            if (sortBtn.value === 'title-asc') return (a.projet || '').localeCompare(b.projet || '');
            return 0;
          });

          // 3. Affichage avec DATA-LABEL pour le mobile
          rolesFiltres.forEach(role => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td data-label="Année">${role.annee || ''}</td>
              <td data-label="Titre">${role.projet || ''}</td>
              <td data-label="Rôle">${role.titre || ''}</td>
              <td data-label="Réalisateur">${role.realisateur || '-'}</td>
              <td data-label="Catégorie">${role.type || ''}</td>
              <td data-label="Lien"><a class="btn" href="${role.lien || '#'}" target="_blank">Voir</a></td>
            `;
            tbody.appendChild(tr);
          });
        }

        filterCat.addEventListener('change', afficherTableau);
        sortBtn.addEventListener('change', afficherTableau);
        afficherTableau();

      } catch (e) { console.error("Erreur Firebase:", e); }
    }
    chargerFilmographie();
  </script>
  <script src="js/main.js" defer></script>
</body>
</html>
